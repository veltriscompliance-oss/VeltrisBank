{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Set Security PIN | Veltris Bank</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- GLOBAL THEME VARIABLES --- */
        :root { 
            --primary: #004d99; 
            --light: #f4f6f8; 
            --dark: #1a1a1a; 
            --border: #e2e8f0; 
            --card-bg: #ffffff;
            --text-main: #1a1a1a;
            --text-light: #64748b;
            --input-bg: #ffffff;
        }

        /* DARK MODE OVERRIDES */
        body.dark-mode {
            --light: #0f172a; 
            --card-bg: #1e293b; 
            --text-main: #f8fafc; 
            --text-light: #94a3b8;
            --border: #334155;
            --dark: #f8fafc; 
            --input-bg: #0f172a;
        }

        /* Specific Dark Mode Fixes */
        body.dark-mode .card { background: var(--card-bg); border-color: var(--border); }
        body.dark-mode input { background: var(--input-bg); border-color: var(--border); color: white; }
        body.dark-mode .icon-box { background: rgba(59, 130, 246, 0.2); border-color: rgba(59, 130, 246, 0.3); }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            margin: 0; font-family: 'Inter', sans-serif; 
            height: 100vh; overflow: hidden;
            background: var(--light); color: var(--text-main);
            display: flex; align-items: center; justify-content: center;
            position: relative; transition: 0.3s;
        }

        /* --- ANIMATED BACKGROUND (Only visible in Dark Mode for effect, or subtle in light) --- */
        .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0; z-index: 0; transition: 0.5s; }
        body.dark-mode .orb { opacity: 0.4; }
        .orb-1 { width: 400px; height: 400px; background: #1e40af; top: -100px; left: -100px; animation: float 10s infinite alternate; }
        .orb-2 { width: 300px; height: 300px; background: #0891b2; bottom: -100px; right: -50px; animation: float 12s infinite alternate-reverse; }
        @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 50px); } }

        /* CARD */
        .card {
            width: 90%; max-width: 420px; padding: 50px 40px; text-align: center;
            background: var(--card-bg); 
            border: 1px solid var(--border); border-radius: 24px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.1); 
            z-index: 10; position: relative; margin: 20px;
        }

        .icon-box {
            width: 70px; height: 70px; background: rgba(0, 77, 153, 0.1); 
            border-radius: 24px; display: flex; align-items: center; justify-content: center;
            margin: 0 auto 30px; border: 1px solid rgba(0, 77, 153, 0.2);
            color: var(--primary);
        }
        .icon-box svg { width: 32px; height: 32px; }

        h2 { margin: 0 0 10px 0; font-size: 24px; font-weight: 800; letter-spacing: -0.5px; color: var(--text-main); }
        p { color: var(--text-light); font-size: 15px; line-height: 1.6; margin-bottom: 30px; }

        /* PIN INPUTS */
        .input-group { margin-bottom: 20px; text-align: left; }
        label { display: block; font-size: 12px; font-weight: 600; color: var(--text-light); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        
        input {
            width: 100%; padding: 18px; 
            background: var(--input-bg); border: 1px solid var(--border);
            border-radius: 14px; color: var(--text-main); font-size: 24px; font-weight: 700;
            text-align: center; letter-spacing: 8px; outline: none; transition: 0.3s;
            font-family: monospace;
        }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0, 77, 153, 0.1); }
        input::placeholder { font-size: 16px; letter-spacing: 1px; font-weight: 500; opacity: 0.3; font-family: 'Inter'; }

        /* BUTTON */
        button {
            width: 100%; padding: 16px; margin-top: 10px;
            background: var(--primary); color: white; border: none; border-radius: 14px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            transition: 0.2s; box-shadow: 0 4px 15px rgba(0, 77, 153, 0.2);
        }
        button:hover { transform: translateY(-2px); background: #003d80; }

        .messages { background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(220, 38, 38, 0.2); color: #dc2626; padding: 12px; border-radius: 10px; font-size: 13px; margin-bottom: 25px; }

        @media (max-width: 480px) {
            .card { padding: 40px 25px; }
            h2 { font-size: 22px; }
        }
    </style>
</head>
<body class="{% if user.account.dark_mode %}dark-mode{% endif %}">
    
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <div class="card">
        <div class="icon-box">
            <!-- LOCK ICON -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        </div>
        
        <h2>Set Transaction PIN</h2>
        <p>Create a secure 4-digit PIN. You will need this to authorize all future transfers.</p>

        {% if messages %}
            {% for message in messages %}
            <div class="messages">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <form method="POST">
            {% csrf_token %}
            
            <div class="input-group">
                <label>Enter 4-Digit PIN</label>
                <input type="password" name="pin" maxlength="4" placeholder="••••" inputmode="numeric" pattern="[0-9]*" autofocus required>
            </div>
            
            <div class="input-group">
                <label>Confirm PIN</label>
                <input type="password" name="confirm_pin" maxlength="4" placeholder="••••" inputmode="numeric" pattern="[0-9]*" required>
            </div>

            <button type="submit">Save Security PIN</button>
        </form>
    </div>

</body>
</html>